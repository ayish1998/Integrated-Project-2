<!DOCTYPE html>
<html>
<head>
  <title>API Response Visualization</title>
  <style>
    #slideshow {
      position: relative;
      width: 600px;
      height: 400px;
      margin: 20px auto;
    }

    #slideshow img {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    #slideshow img.active {
      opacity: 1;
    }

    .container {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      margin-top: 20px;
    }

    .chart-container {
      flex: 1;
      margin: 20px;
      height: 400px;
    }

    #barChartCanvas,
    #pieChartCanvas {
      width: 100%;
      height: 100%;
    }
  </style>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
  <div class="container">
    <div class="col-md-12 text-center">
      <h1 class="my-4">Online Data Visualization</h1>
    </div>
  </div>

  <div id="slideshow" class="container">
    <img src="Images/Grouped-Bar-Chart.png" class="active">
    <img src="Images/Bar-chart.jpg">
    <img src="Images/table-elements.png">
  </div>

  <div class="container">
    <div class="col-md-12">
      <table id="data-table" class="table">
        <thead>
          <tr>
            <th>Location</th>
            <th>Job Title</th>
            <th>Publisher Name</th>
            <th>Min Salary</th>
            <th>Max Salary</th>
            <th>Median Pay</th>
            <th>Salary Period</th>
            <th>Salary Currency</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="container">
    <div class="chart-container">
      <h2 class="text-center">Bar Chart</h2>
      <canvas id="barChartCanvas"></canvas>
    </div>
    <div class="chart-container">
      <h2 class="text-center">Pie Chart</h2>
      <canvas id="pieChartCanvas"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Slideshow
    const images = document.querySelectorAll('#slideshow img');
    let currentIndex = 0;

    function showImage(index) {
      images.forEach((image) => {
        image.classList.remove('active');
      });

      images[index].classList.add('active');
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % images.length;
      showImage(currentIndex);
    }

    setInterval(nextImage, 3000);

    const url =
      'https://job-salary-data.p.rapidapi.com/job-salary?job_title=nodejs%20developer&location=new%20york%2C%20usa&radius=200';
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': '94fc9d3c6fmshde40d7a8e2e37f5p12b547jsnc0f0f606c2fb',
        'X-RapidAPI-Host': 'job-salary-data.p.rapidapi.com',
      },
    };

    fetch(url, options)
      .then((response) => response.json())
      .then((data) => {
        if (data.status === 'OK') {
          const dataTable = document.getElementById('data-table');
          const tbody = dataTable.getElementsByTagName('tbody')[0];

          data.data.forEach((job) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${job.location}</td>
              <td>${job.job_title}</td>
              <td>${job.publisher_name}</td>
              <td>${job.min_salary}</td>
              <td>${job.max_salary}</td>
              <td>${job.median_pay}</td>
              <td>${job.salary_period}</td>
              <td>${job.salary_currency}</td>
            `;
            tbody.appendChild(row);
          });

          const salaries = data.data.map((job) => job.median_pay);
          const locations = data.data.map((job) => job.location);
          const minSalaries = data.data.map((job) => job.min_salary);
          const maxSalaries = data.data.map((job) => job.max_salary);

          // Bar Chart
          const barChartCanvas = document.getElementById('barChartCanvas');
          new Chart(barChartCanvas, {
            type: 'bar',
            data: {
              labels: locations,
              datasets: [
                {
                  label: 'Minimum Salary',
                  data: minSalaries,
                  backgroundColor: 'rgba(255, 99, 132, 0.6)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  borderWidth: 1,
                },
                {
                  label: 'Maximum Salary',
                  data: maxSalaries,
                  backgroundColor: 'rgba(54, 162, 235, 0.6)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1,
                },
                {
                  label: 'Median Salary',
                  data: salaries,
                  backgroundColor: 'rgba(75, 192, 192, 0.6)',
                  borderColor: 'rgba(75, 192, 192, 1)',
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    stepSize: 10000,
                  },
                },
              },
            },
          });

          // Pie Chart
          const pieChartCanvas = document.getElementById('pieChartCanvas');
          const minMaxSalaries = [Math.min(...salaries), Math.max(...salaries)];
          new Chart(pieChartCanvas, {
            type: 'pie',
            data: {
              labels: [
                'Minimum Salary: ' + minMaxSalaries[0],
                'Maximum Salary: ' + minMaxSalaries[1],
              ],
              datasets: [
                {
                  data: minMaxSalaries,
                  backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)'],
                  borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)'],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
            },
          });
        }
      })
      .catch((error) => console.error(error));
  </script>
</body>
</html>
